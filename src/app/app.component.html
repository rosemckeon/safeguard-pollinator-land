<main class="h-dvh flex gap-0">
  <section class="h-full w-3/4">
    <router-outlet />
  </section>
  <section class="controls h-full w-1/4 p-10">
    @if (roundService.activeRound == 0) {
      <h1 class="mb-2">This game has three rounds</h1>
    } @else {
      <h1 class="mb-2">Can you keep improving your impact scores?</h1>
    }
    <span class="bee-icon"></span>
    <div class="grid grid-cols-4 gap-2 mb-5">
      <app-round-details  *ngFor="let round of roundService.roundList" [round]="round"></app-round-details>
    </div>
    @if(roundService.endRound != roundService.activeRound) {
      <p class="mb-5"><strong>Your aim is to improve pollinator numbers without making people unhappy </strong> <button class="icon-only" (click)="openInfo('gameInfo')"><ng-icon name="heroInformationCircleSolid"></ng-icon></button></p>
    }
    @if (roundService.activeRound == 0) {
      <p class="mb-5"><ng-icon name="heroArrowLeft"></ng-icon> Your landscape is made of three habitat types. The state of wild pollinator populations and their resources is shown on every square.</p>
      <p class="mb-5">The overall state of your landscape has impacts on people <ng-icon name="heroArrowDown"></ng-icon></p>
    }
      <div class="round-impacts p-5 mb-5">
        @if(roundService.endRound != roundService.activeRound) {
          <h2 class="mb-5 text-center"><strong>Landscape Impacts</strong></h2>
        } @else {
          <h2 class="mb-5 text-center"><strong>Final Landscape Impacts</strong></h2>
        }
        <div id="impact-scores" class="grid grid-cols-4 gap-5">
          <div class="impact text-center align-top">
            <p class="text-center">
              <img class="impact-icon h-20" src="./assets/pollination-and-production-colour.svg" alt="Crop Pollination & Production" matTooltip="Crop Pollination & Production" [matTooltipPosition]="'above'" />
              <strong class="impact-score block text-xl">{{ roundService.roundImpacts.cropPollinationProduction }}%</strong>
              <button class="icon-only" (click)="openInfo('cropPollination')" matTooltip="Find out more"><ng-icon name="heroInformationCircleSolid"></ng-icon></button>
            </p>
          </div>
          <div class="impact text-center align-top">
            <p class="text-center">
              <img class="impact-icon h-20" src="./assets/economic-value-chain-colour.svg" alt="Economic Value Chain (Farm2Fork)" matTooltip="Economic Value Chain" [matTooltipPosition]="'above'" />
              <strong class="impact-score block text-xl">{{ roundService.roundImpacts.economicValueChain }}%</strong>
              <!--<strong class="impact-label block text-sm"></strong>-->
              <button class="icon-only" (click)="openInfo('economicValueChain')" matTooltip="Find out more"><ng-icon name="heroInformationCircleSolid"></ng-icon></button>
            </p>
          </div>
          <div class="impact text-center align-top">
            <p class="text-center">
              <img class="impact-icon h-20" src="./assets/wild-plant-pollination-services-colour.svg" alt="Wild Plant Pollinations Services" matTooltip="Wild Plant Pollinations Services" [matTooltipPosition]="'above'" />
              <strong class="impact-score block text-xl">{{ roundService.roundImpacts.wildPlantPollination }}%</strong>
              <button class="icon-only" (click)="openInfo('wildPlantPollination')" matTooltip="Find out more"><ng-icon name="heroInformationCircleSolid"></ng-icon></button>
            </p>
          </div>
          <div class="impact text-center align-top">
            <p class="text-center">
              <img class="impact-icon h-20" src="./assets/aesthetic-values-colour.svg" alt="Aesthetic Values" matTooltip="Aesthetic Values" [matTooltipPosition]="'above'" />
              <strong class="impact-score block text-xl">{{ roundService.roundImpacts.aestheticValues }}%</strong>
              <button class="icon-only" (click)="openInfo('aestheticValues')" matTooltip="Find out more"><ng-icon name="heroInformationCircleSolid"></ng-icon></button>
            </p>
          </div>
        </div>
        <!--<app-round-impacts  *ngFor="let impact of roundService.roundImpacts" [roundImpact]="impact"></app-round-impacts>-->
      </div>
    @if(roundService.endRound != roundService.activeRound) {
      @if (roundService.activeRound == 0) {
        <p class="mb-5">To change your impact result <strong>Make responses</strong> which affect all habitats of a particular type <ng-icon name="heroArrowDown"></ng-icon></p>
      } @else {
        <p class="mb-5 mt-10"><strong>Make responses:</strong></p>
      }
        <app-global-responses />
      <p class="mt-10 hidden">You can also select habitat cells on your landscape and <strong>locally overide your global descisions</strong>.</p>
      @if (roundService.activeRound == 0) {
        <p class="my-10"><strong>When you're done making descisions...</strong></p>
        <button (click)="advanceTime(roundService.activeRound, roundService.scenario!, habitatService.habitatList, roundService.roundList)" class="button px-4 pt-2 pb-4">Advance time <ng-icon name="heroArrowRight"></ng-icon></button>
      } @else {
        <button (click)="advanceTime(roundService.activeRound, roundService.scenario!, habitatService.habitatList, roundService.roundList)" class="button px-4 pt-2 pb-4 mt-10">Advance time <ng-icon name="heroArrowRight"></ng-icon></button>
      }
      
    } @else {
      @if(roundService.scenario == 'B') {
        <a href="/B" class="button px-4 py-2">Play Again <ng-icon name="heroArrowPath"></ng-icon></a>
      } @else {
        <a href="/" class="button px-4 py-2">Play Again <ng-icon name="heroArrowPath"></ng-icon></a>
      }
    }
  </section>
</main>